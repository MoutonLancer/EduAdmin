<!DOCTYPE html><html lang="zh"><head>    <!-- 页面meta -->    <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta content="width=device-width,initial-scale=1,maximum-scale=1,admin-scalable=no" name="viewport">    <title>教务管理系统</title>    <!-- 引入样式 -->    <link rel="stylesheet" href="../../css/userPage.css">    <link rel="stylesheet" href="../../plugins/elementUI/index.css">    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">    <link rel="stylesheet" href="../../css/style.css"></head><body class="hold-transition"><div id="app">    <div class="layout">        <div class="sidebar">            <nav class="nav">                <ul>                    <div class="info">                        <p>                            {{studentInfo.studentId}}                            <br>                            {{studentInfo.studentName}}                        </p>                    </div>                    <li>                        <a class="nav-link"  @click="setPageFlag(1)">                            <i class="fa fa-clock-o"></i><em>课程安排</em>                        </a>                    </li>                    <li>                        <a class="nav-link"  @click="setPageFlag(2)">                            <i class="fa fa-home"></i><em>成绩查询</em>                        </a>                    </li>                    <li>                        <a class="nav-link"  @click="setPageFlag(3)">                            <i class="fa fa-file-text-o"></i><em>请假申请</em>                        </a>                    </li>                </ul>            </nav>        </div>        <div class="content">            <!-- 显示数据信息 -->            <!--bug:同父元素的el-table的key相同会导致渲染错误    https://blog.csdn.net/fifteen718/article/details/82897948-->            <template v-if="this.pageFlag==1">                <el-table border :key="this.pageFlag" size="small" current-row-key="id" :data="courseTable" stripe highlight-current-row>                    <el-table-column type="index" label="序号" align="center" ></el-table-column>                    <el-table-column prop="key1" label="周一" align="center"></el-table-column>                    <el-table-column prop="key2" label="周二" align="center"></el-table-column>                    <el-table-column prop="key3" label="周三" align="center"></el-table-column>                    <el-table-column prop="key4" label="周四" align="center"></el-table-column>                    <el-table-column prop="key5" label="周五" align="center"></el-table-column>                    <el-table-column prop="key6" label="周六" align="center"></el-table-column>                    <el-table-column prop="key7" label="周日" align="center"></el-table-column>                </el-table>            </template>            <template v-if="this.pageFlag==2">                <el-table   :key="this.pageFlag" size="small" current-row-key="id" :data="dataList" stripe highlight-current-row>        <el-table-column type="index" label="序号" align="center" ></el-table-column>        <el-table-column prop="id" label="id" align="center" v-if="false"></el-table-column>        <el-table-column prop="courseId" label="课程编号" align="center"></el-table-column>        <el-table-column prop="courseName" label="课程名称" align="center"></el-table-column>        <el-table-column prop="teacherId" label="教师编号" align="center"></el-table-column>        <el-table-column prop="studentId" label="学号" align="center"></el-table-column>        <el-table-column prop="score" label="考试成绩" align="center"></el-table-column>    </el-table>                 <el-pagination                    layout="total,prev,pager,next,jumper"                    class="pagination"                    @current-change=handleCurrentChangeOfScore                    :current-page="pagination.currentPage"                    :page-size="pagination.pageSize"                    :total ="pagination.total">                </el-pagination>            </template>            <template v-if="this.pageFlag==3">                <el-table :key="this.pageFlag" size="small"  current-row-key="id" :data="dataList" stripe highlight-current-row>                    <el-table-column type="index" label="序号" align="center" ></el-table-column>                    <el-table-column v-if="false" prop="id" label="id" align="center" ></el-table-column>                    <el-table-column label="请假原因" prop="reason"  align="center"></el-table-column>                    <el-table-column label="请假时间" prop="startTime" :formatter="dateFormat"  align="center"></el-table-column>                    <el-table-column label="销假时间" prop="endTime" :formatter="dateFormat" align="center"></el-table-column>                    <el-table-column label="审核结果" prop="state" align="center">                        <template slot-scope="scope">                            <el-tag v-if="scope.row.state == '1'"    type="success">通过</el-tag>                            <el-tag v-if="scope.row.state == '-1'"   type="danger">未通过</el-tag>                            <el-tag v-if="scope.row.state == '0'"    type="warning">待审核</el-tag>                        </template>                    </el-table-column>                    <el-table-column label="审批人"   prop="approver"  align="center"></el-table-column>                </el-table>                <el-pagination                        layout="total,prev,pager,next,jumper"                        class="pagination"                        @current-change=handleCurrentChangeOfLeave                        :current-page="pagination.currentPage"                        :page-size="pagination.pageSize"                        :total ="pagination.total">                </el-pagination>            </template>        </div>    </div></div></body><!-- 引入组件库 --><script src="../../js/vue.js"></script><script src="../../js/moment.js"></script><script src="../../plugins/elementUI/index.js"></script><script src="../../js/jquery.min.js"></script><script src="../../js/axios-0.18.0.js"></script><script>    var vue = new Vue({        el: '#app',        data:{            pagination:{//初始分页模型数据                currentPage: 1,                pageSize:10,                total:0            },            studentInfo:{},            controllerPath:'/students',            pageFlag: 1,            dataList: [],//当前页要展示的列表数据            courseTable:[] //datalist处理后，展示的课程表数据        },        created() {            axios.defaults.headers.common['Authorization'] =localStorage.getItem('token');            axios.interceptors.response.use(resp => {                // 确认token是否无效或过期                if (resp.data.code == 401){                    window.alert("身份认证无效或过期，请重新登录");                    window.location.href = "./studentLogin.html";                }                return resp;            });            this.setPageFlag(this.pageFlag);            this.getStudentInfo();        },        methods: {            //获取所有记录            setPageFlag(state){                this.pageFlag = state;                if (state == 1) this.getCourseTable();                if (state == 2) this.getScorePage();                if (state == 3) this.getLeavePage();            },            //查询请假记录            getLeavePage(){                axios.get(this.controllerPath+"/leave/1/10").then(res =>{                    this.dataList = res.data.data.records;                    this.pagination.currentPage = res.data.data.current;                    this.pagination.pageSize    = res.data.data.size;                    this.pagination.total  = res.data.data.total;                })            },            //查询课程表            getCourseTable(){                axios.get(this.controllerPath+"/course").then(res =>{                    this.dataList = res.data.data;                    this.courseTable = this.courseTableHandle(this.dataList);                })            },            //查询成绩信息            getScorePage(){                axios.get(this.controllerPath+"/score/1/10").then(res =>{                    this.dataList = res.data.data.records;                    this.pagination.currentPage = res.data.data.current;                    this.pagination.pageSize    = res.data.data.size;                    this.pagination.total  = res.data.data.total;                })            },            getStudentInfo(){                axios.get(this.controllerPath+"/info").then(res =>{                    this.studentInfo = res.data.data;                })            },            //时间戳转日期格式            dateFormat(row, column) {                var date = row[column.property];                if (date == undefined) {                    return "";                }                return moment(date).format("YYYY-MM-DD");            },            //分页页码变动-触发重新查询            handleCurrentChangeOfLeave(currentPage){                this.pagination.currentPage = currentPage;                this.getLeavePage();            },            handleCurrentChangeOfScore(currentPage){                this.pagination.currentPage = currentPage;                this.getScorePage();            },            courseTableHandle(data){                //后端传递过来的数据dataconst data=[{"courseName":"物理","timeSlot":"1","dayOfWeek":"2"}]                const list = [];                for(i = 0;i<10;i++){                    const dayData = { key1: "-", key2: "-", key3: "-", key4: "-", key5: "-", key6: "-", key7: "-" };                    list.push(dayData);                }                //填充实际数据                for(course of data){                    list[course.timeSlot-1]["key"+course.dayOfWeek] = course.courseName;                }                return list;            }        }    });</script></html>